apiVersion: 2021-09-01
location: southeastasia
name: rental-room-api
properties:
  containers:
  - name: api
    properties:
      image: rentalroomacr.azurecr.io/rental-room-api:latest
      resources:
        requests:
          cpu: 1.0
          memoryInGb: 1.5
      ports:
      - port: 3000
        protocol: TCP
      environmentVariables:
      # Application
      - name: NODE_ENV
        value: ${NODE_ENV}
      - name: PORT
        value: ${PORT}
      - name: CORS_ORIGIN
        value: ${CORS_ORIGIN}
      
      # Database (use secureValue for sensitive data)
      - name: DATABASE_URL
        secureValue: ${DATABASE_URL}
      
      # Redis
      - name: REDIS_HOST
        value: ${REDIS_HOST}
      - name: REDIS_PORT
        value: ${REDIS_PORT}
      - name: REDIS_PASSWORD
        secureValue: ${REDIS_PASSWORD}
      - name: REDIS_TTL
        value: ${REDIS_TTL}
      
      # JWT
      - name: JWT_SECRET
        secureValue: ${JWT_SECRET}
      - name: JWT_EXPIRES_IN
        value: ${JWT_EXPIRES_IN}
      - name: JWT_REFRESH_SECRET
        secureValue: ${JWT_REFRESH_SECRET}
      - name: JWT_REFRESH_EXPIRES_IN
        value: ${JWT_REFRESH_EXPIRES_IN}
      
      # Email
      - name: MAIL_HOST
        value: ${MAIL_HOST}
      - name: MAIL_PORT
        value: ${MAIL_PORT}
      - name: MAIL_USER
        value: ${MAIL_USER}
      - name: MAIL_PASSWORD
        secureValue: ${MAIL_PASSWORD}
      - name: MAIL_FROM
        value: ${MAIL_FROM}
      - name: MAIL_FROM_NAME
        value: ${MAIL_FROM_NAME}
      
      # AI
      - name: GEMINI_API_KEY
        secureValue: ${GEMINI_API_KEY}

      # ImageKit (Storage)
      - name: IMAGEKIT_PUBLIC_KEY
        value: ${IMAGEKIT_PUBLIC_KEY}
      - name: IMAGEKIT_PRIVATE_KEY
        secureValue: ${IMAGEKIT_PRIVATE_KEY}
      - name: IMAGEKIT_URL_ENDPOINT
        value: ${IMAGEKIT_URL_ENDPOINT}

      # SePay (Payments)
      - name: ENCRYPTION_KEY
        secureValue: ${ENCRYPTION_KEY}
      - name: SEPAY_API_URL
        value: ${SEPAY_API_URL}
      - name: SEPAY_API_TOKEN
        secureValue: ${SEPAY_API_TOKEN}
      - name: P12_PASSWORD
        secureValue: ${P12_PASSWORD}
  
  osType: Linux
  ipAddress:
    type: Public
    ports:
    - protocol: TCP
      port: 3000
    dnsNameLabel: rental-room-api
  
  imageRegistryCredentials:
  - server: rentalroomacr.azurecr.io
    username: rentalroomacr
    password: ${ACR_PASSWORD}

tags:
  environment: production
  project: rental-room

type: Microsoft.ContainerInstance/containerGroups
